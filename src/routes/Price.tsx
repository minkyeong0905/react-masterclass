import { useQuery } from "react-query";
import { useParams } from "react-router-dom";
import { fetchCoinHistory } from "../api";
import styled from "styled-components";

const Grid = styled.div`
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    grid-template-rows: repeat(3, auto);
    gap: 0.5rem;
    width: 100%;
`;

const Cell = styled.div`
    border: 1px solid #ccc;
    padding: 1rem;
    box-sizing: border-box;
    text-align: center;
    display: flex;
    flex-direction: column;
    justify-content: center;
    height: 80px;

    &.merged {
        grid-column: 1 / span 2;
        grid-row: 3;
    }
`;

const TopSpan = styled.span`
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
    justify-content: center;

    svg {
        width: 24px;
        height: 24px;
    }
`;

const BottomSpan = styled.span`
    font-size: 18px;
    font-weight: bold;
    color: whitesmoke;
`;

interface IHistorical {
    time_open: number;
    time_close: number;
    open: string;
    high: string;
    low: string;
    close: string;
    volume: string;
    market_cap: number;
}

function Price() {
    const { coinId } = useParams();
    const { isLoading, data } = useQuery<IHistorical[]>(["ohlcv", coinId], () => fetchCoinHistory(coinId!));
    const recentData = data?.[data.length - 1];

    return (
        <div>
            {isLoading ? "Loading Price Data..." :
            <>
                <h3 style={{textAlign: "center", fontSize: "22px", marginBottom: "10px"}}>Recent Price Data</h3>
                <Grid>
                    <Cell>
                        <TopSpan>
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                                <g fill="none" fill-rule="evenodd" clip-rule="evenodd">
                                    <path fill="#020202" d="M20.455 1.273c.41.1.76.67 1.11 1.29a16.3 16.3 0 0 1 1.161 2.802a6.46 6.46 0 0 1-.13 3.002c-.16.32-.47.46-1 .43q-.453-.015-.891-.13a2.11 2.11 0 0 1-1.701-2.762l3.212-.06a.34.34 0 0 0 0-.67l-3.142-.17C17.443.512 17.664 1.102 17.583.942c.965.03 1.925.14 2.872.33m-3.582 7.284a2.1 2.1 0 0 1-1.622-.14a2.19 2.19 0 0 1-1.16-2.471h4.002a2.34 2.34 0 0 1-1.22 2.611m-.08-7.615c0 .12.1.25.14.38c.12 1.27.438 2.512.94 3.683l-3.742-.13a13.3 13.3 0 0 0-.77-4.003c.18-.03 3.402-.02 3.432.07M12.12 8.447a2.56 2.56 0 0 1-2.432-.27c-.47-2.442-.41-1.871-.31-2.302c.8 0 3.332.06 3.772.07c.06.871.26 1.772-1.03 2.502M11.88.842c1.5 0 .48-.23 1.15 4.003c-1 0-2.071-.05-3.092-.05l1.3-2.592a4.6 4.6 0 0 0 .641-1.36m-4.143.79c.47-.62.46-.53.33-.75c3.372-.06 3.102-.06 3.002 0a22.4 22.4 0 0 0-2.442 3.893c-1.21 0-2.361 0-3.372.06c1.01-1.161 1.821-2.342 2.482-3.202M4.485 5.696l3.832.15c0 .33 0-.19.11 1.521c-.29.18-.29.851-.79 1.201a2.78 2.78 0 0 1-2.422.09c-1.02-.47-.9-2.271-.73-2.962m16.72 4.183c2.152.19 2.672-.93 2.732-3.072l-.17-1.641a16.7 16.7 0 0 0-1.631-3.572A2.78 2.78 0 0 0 20.675.342c-3.052-.72-14.52-.08-15.55-.07a.34.34 0 1 0 0 .67h2.291a30 30 0 0 0-3.602 4.003c-1.32-.01-2.241.06-2.481.06a.3.3 0 0 0 .1.59h2.111c.08 2.412.31 1-.26 2.812c-1 1.28-3.362-.89-2.362-3.002a34 34 0 0 1 2.932-4.343a.3.3 0 0 0-.45-.39c-.33.38-1 1.26-1.641 2.182C-.298 5.785.102 5.535.082 7.346a2.33 2.33 0 0 0 1.66 2.152l.731.11a1.74 1.74 0 0 0 1.571-.71c1 1.22 3.683 1.4 4.723-.09a3.67 3.67 0 0 0 3.893.61a4.8 4.8 0 0 0 1-.85a3.22 3.22 0 0 0 3.613 1c.498-.217.93-.562 1.25-1c.48.587 1.142 1 1.882 1.17zm-15.88 6.293a.341.341 0 0 0-.183.621a.34.34 0 0 0 .273.05c1.1-.13.79 4.002-.33 3.732s-1.351-2.482-.59-3.312a.3.3 0 0 0-.41-.43c-1.352 1.18-1.302 4.182.69 4.823c2.982.92 2.922-5.934.55-5.484m5.854-.1a2.2 2.2 0 0 0-1-.17c-1.602 0-2.122.66-2.122 1.881c0 .08.42 3.422.4 3.342a.3.3 0 0 0 .54-.06v-2.161c.434.18.913.222 1.371.12a1.61 1.61 0 0 0 .81-2.952m-2.182 2.111c-.017-.346.055-.69.21-1c.06-.1 1.642-.48 1.652.24s-1.001.99-1.862.76m4.324 2.232c.09-.38 0 0 .19-1c.72.26 1.771-.12 1.771-.451s-1.13-.7-1.7-.47c0-.74-.12-1.161.28-1.271c.63-.17 1.47 0 1.43-.46a.31.31 0 0 0-.32-.27c-.93 0-2.131-.421-2.411 1.12c0 .08-.15 1.531-.14 1.44c0 .501-.41 1.882.28 2.292s1.2 0 1.65-.07h.761a.43.43 0 0 0 .41-.36c0-.53-2.12-.54-2.2-.5m6.503-3.512c0 .29-.14 1.26-.27 2.14a6.2 6.2 0 0 0-1.31-1.85a3.5 3.5 0 0 0-.681-.61a.69.69 0 0 0-.68 0c-.55.32-.42.58-.17 3.562a5.4 5.4 0 0 0 0 .86c.12.49.58.51.68.2c0-.08 0 .45.05-3.162a14.8 14.8 0 0 1 1.831 3.002a.54.54 0 0 0 .79 0c.37-.41.39-4.002.39-4.132a.34.34 0 0 0-.63-.01" />
                                    <path fill="#0c6fff" d="M23.007 14.591a6.6 6.6 0 0 0-2.352-.5c.271-.954.445-1.933.52-2.922c0-.91-.93-1.09-1.1-.13q-.147 1.482-.07 2.972a117 117 0 0 0-17.081.09a9.9 9.9 0 0 0-.16-3.453c-.26-1.06-1.051-.77-1.051 0q.04.868.2 1.722c0 .09.33 1.74.35 1.82c-1.77.261-1.931.451-1.891 1.242c.06 1.41.47 6.194 1 7.504c.06.15.39.4 1.001.52c3.222.641 17.391.851 19.543-.13c.86-.39 1.16-2.5 1.3-3.452c.14-.95.551-4.683-.21-5.283m-1.431 7.245c-.08.23-.15.59-.23.5c-1.952.79-17.142.89-19.373.24c-.55-1.56-.98-7.014-1.07-7.334c.47-.62 7.744-.62 8.515-.62a110 110 0 0 1 11.907.61c1.231.18 1.001.16 1.001.74a21.3 21.3 0 0 1-.71 5.864z" />
                                </g>
                            </svg>
                            <span>Open</span>
                        </TopSpan>
                        <BottomSpan>${recentData?.open}</BottomSpan>
                    </Cell>
                    <Cell>
                        <TopSpan>
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                                <g fill="none" fill-rule="evenodd" clip-rule="evenodd">
                                    <path fill="#020202" d="M5.625 20.325c0 .33-.37.27-.69.21c-.87-.17-1.29-.59-1.21-1.721c.09-1.281.82-2.232 1.85-1.501a.311.311 0 1 0 .42-.46c-2.15-2.132-4.492 1.88-2.801 3.862a2.92 2.92 0 0 0 2.001.68c.66-.06 1.17-.36 1.13-1.07a.35.35 0 0 0-.7 0m2.372.07v-2.312c-.21-1.63-.16-1.35-.17-1.39a.35.35 0 0 0-.61.19c0 .09-.34 2.511-.34 2.761c0 .44.08 1.351.49 1.541a3.9 3.9 0 0 0 1.63.15c.55-.12.651-.48.44-.69a4.7 4.7 0 0 0-1.44-.25m4.863-3.082c-2.061-2.632-3.482 1.25-2.352 3.082a1.55 1.55 0 0 0 2.242.55a2.89 2.89 0 0 0 .11-3.632m-.93 2.792c-.681-.09-.931-1.381-.821-2.092c.13-.91.44-1.39 1.12-.3s.1 2.442-.3 2.392m3.142-2.432a.53.53 0 0 1 .07-.45c.42-.54.951.15 1.271.05s.29-.79-.77-1a1.42 1.42 0 0 0-1.211 2.39c.51.611 1.54.951 1.45 1.412s-.55.7-.8.6c-.08 0-.45-.38-.64-.38a.34.34 0 0 0-.34.33c0 .33.38.59.67.75a1.61 1.61 0 0 0 2.092-1.06c.49-1.521-1.702-2.092-1.792-2.642m5.594-1.331l-1.57-.21a1.13 1.13 0 0 0-1.072.76a5.2 5.2 0 0 0-.14 2.182a10.5 10.5 0 0 0 0 1.811a.54.54 0 0 0 .49.46a4 4 0 0 0 .691-.16c.17-.05.65 0 .94-.09c.561-.1.661-.44.511-.7s-1.5-.05-1.631-.06l.1-1.131c.38 0 1.471-.19 1.471-.56s-1.17-.62-1.541-.55a5 5 0 0 1 0-.661c0-.21 0-.42.23-.46c1.611-.08 1.621 0 1.691-.26a.29.29 0 0 0-.17-.37m-.21-15.07c.41.1.76.67 1.11 1.29a16.3 16.3 0 0 1 1.161 2.802a6.46 6.46 0 0 1-.13 3.002c-.16.32-.47.46-1 .43q-.453-.015-.891-.13a2.11 2.11 0 0 1-1.701-2.762l3.212-.06a.34.34 0 0 0 0-.67l-3.142-.17C17.443.512 17.664 1.102 17.583.942c.965.03 1.925.14 2.872.33m-3.582 7.284a2.1 2.1 0 0 1-1.622-.14a2.19 2.19 0 0 1-1.16-2.471h4.002a2.34 2.34 0 0 1-1.22 2.611m-.08-7.615c0 .12.1.25.14.38c.12 1.27.438 2.512.94 3.683l-3.742-.13a13.3 13.3 0 0 0-.77-4.003c.18-.03 3.402-.02 3.432.07M12.12 8.447a2.56 2.56 0 0 1-2.432-.27c-.47-2.442-.41-1.871-.31-2.302c.8 0 3.332.06 3.772.07c.06.871.26 1.772-1.03 2.502M11.88.842c1.5 0 .48-.23 1.15 4.003c-1 0-2.071-.05-3.092-.05l1.3-2.592a4.6 4.6 0 0 0 .641-1.36m-4.143.79c.47-.62.46-.53.33-.75c3.372-.06 3.102-.06 3.002 0a22.4 22.4 0 0 0-2.442 3.893c-1.21 0-2.361 0-3.372.06c1.01-1.161 1.821-2.342 2.482-3.202M4.485 5.696l3.832.15c0 .33 0-.19.11 1.521c-.29.18-.29.851-.79 1.201a2.78 2.78 0 0 1-2.422.09c-1.02-.47-.9-2.271-.73-2.962m16.72 4.183c2.152.19 2.672-.93 2.732-3.072l-.17-1.641a16.7 16.7 0 0 0-1.631-3.572A2.78 2.78 0 0 0 20.675.342c-3.052-.72-14.52-.08-15.55-.07a.34.34 0 1 0 0 .67h2.291a30 30 0 0 0-3.602 4.003c-1.32-.01-2.241.06-2.481.06a.3.3 0 0 0 .1.59h2.111c.08 2.412.31 1-.26 2.812c-1 1.28-3.362-.89-2.362-3.002a34 34 0 0 1 2.932-4.343a.3.3 0 0 0-.45-.39c-.33.38-1 1.26-1.641 2.182C-.298 5.785.102 5.535.082 7.346a2.33 2.33 0 0 0 1.66 2.152l.731.11a1.74 1.74 0 0 0 1.571-.71c1 1.22 3.683 1.4 4.723-.09a3.67 3.67 0 0 0 3.893.61a4.8 4.8 0 0 0 1-.85a3.22 3.22 0 0 0 3.613 1c.498-.217.93-.562 1.25-1c.48.587 1.142 1 1.882 1.17z" />
                                    <path fill="#0c6fff" d="M23.007 14.591a6.6 6.6 0 0 0-2.352-.5c.271-.954.445-1.933.52-2.922c0-.91-.93-1.09-1.1-.13q-.147 1.482-.07 2.972a117 117 0 0 0-17.081.09a9.9 9.9 0 0 0-.16-3.453c-.26-1.06-1.051-.77-1.051 0q.04.868.2 1.722c0 .09.33 1.74.35 1.82c-1.77.261-1.931.451-1.891 1.242c.06 1.41.47 6.194 1 7.504c.06.15.39.4 1.001.52c3.222.641 17.391.851 19.543-.13c.86-.39 1.16-2.5 1.3-3.452c.14-.95.551-4.683-.21-5.283m-1.431 7.245c-.08.23-.15.59-.23.5c-1.952.79-17.142.89-19.373.24c-.55-1.56-.98-7.014-1.07-7.334c.47-.62 7.744-.62 8.515-.62a110 110 0 0 1 11.907.61c1.231.18 1.001.16 1.001.74a21.3 21.3 0 0 1-.71 5.864z" />
                                </g>
                            </svg>
                            <span>Close</span>
                        </TopSpan>
                        <BottomSpan>${recentData?.close}</BottomSpan>
                    </Cell>
                    <Cell>
                        <TopSpan>
                            <svg data-slot="icon" fill="none" stroke-width="1.5" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18 9 11.25l4.306 4.306a11.95 11.95 0 0 1 5.814-5.518l2.74-1.22m0 0-5.94-2.281m5.94 2.28-2.28 5.941"></path>
                            </svg>
                            <span>High</span>
                        </TopSpan>
                        <BottomSpan>${recentData?.high}</BottomSpan>
                    </Cell>
                    <Cell>
                        <TopSpan>
                            <svg data-slot="icon" fill="none" stroke-width="1.5" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6 9 12.75l4.286-4.286a11.948 11.948 0 0 1 4.306 6.43l.776 2.898m0 0 3.182-5.511m-3.182 5.51-5.511-3.181"></path>
                            </svg>
                            <span>Low</span>
                        </TopSpan>
                        <BottomSpan>${recentData?.low}</BottomSpan>
                    </Cell>
                    <Cell className="merged">
                        <TopSpan>
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                                <g fill="none">
                                    <path fill="#fff" d="M20 9.5h-5l-2.5 1.429V5.5L9 3.5H4l-3.5 2v15l3.5 2h5l3-1.714l3 1.714h5l3.5-2v-9z" />
                                    <path fill="#bbd8ff" d="M6.5 22.5H9l2.999-1.714l-.499-.286v-9l1-.572V5.5L9 7.5H6.5zm11 0H20l3.5-2v-9l-3.5 2h-2.5z" />
                                    <path stroke="#092f63" stroke-linecap="round" stroke-linejoin="round" d="M12.5 8.5v-3L9 7.5H4l-3.5-2v15" stroke-width="1" />
                                    <path stroke="#092f63" stroke-linecap="round" stroke-linejoin="round" d="m12.5 8.5l-3.5 2H4l-3.5-2m8.975 4.729L9 13.5H4l-3.5-2m8.975 4.729L9 16.5H4l-3.5-2m8.975 4.729L9 19.5H4l-3.5-2m8.975 4.729L9 22.5H4l-3.5-2m0-15l3.5-2h5l3.5 2m11 15v-9l-3.5 2h-5l-3.5-2v9" stroke-width="1" />
                                    <path stroke="#092f63" stroke-linecap="round" stroke-linejoin="round" d="m23.5 14.5l-3.5 2h-5l-3.5-2m12 3l-3.5 2h-5l-3.5-2m12 3l-3.5 2h-5l-3.5-2m0-9l3.5-2h5l3.5 2m-5-10v1m0 4v1m3-3h-1m-4 0h-1" stroke-width="1" />
                                </g>
                            </svg>
                            <span>Volume</span>
                        </TopSpan>
                        <BottomSpan>{recentData?.volume}</BottomSpan>
                    </Cell>
                </Grid>
            </>}
        </div>
    );
}

export default Price;